/*! For license information please see popup.js.LICENSE.txt */
(()=>{var e={61:(e,t,n)=>{var o=n(698).default;function a(){"use strict";e.exports=a=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var t,n={},r=Object.prototype,i=r.hasOwnProperty,s=Object.defineProperty||function(e,t,n){e[t]=n.value},c="function"==typeof Symbol?Symbol:{},l=c.iterator||"@@iterator",d=c.asyncIterator||"@@asyncIterator",u=c.toStringTag||"@@toStringTag";function m(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{m({},"")}catch(t){m=function(e,t,n){return e[t]=n}}function g(e,t,n,o){var a=t&&t.prototype instanceof b?t:b,r=Object.create(a.prototype),i=new E(o||[]);return s(r,"_invoke",{value:z(e,n,i)}),r}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}n.wrap=g;var f="suspendedStart",p="suspendedYield",v="executing",y="completed",w={};function b(){}function C(){}function x(){}var $={};m($,l,(function(){return this}));var M=Object.getPrototypeOf,L=M&&M(M(N([])));L&&L!==r&&i.call(L,l)&&($=L);var I=x.prototype=b.prototype=Object.create($);function T(e){["next","throw","return"].forEach((function(t){m(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function n(a,r,s,c){var l=h(e[a],e,r);if("throw"!==l.type){var d=l.arg,u=d.value;return u&&"object"==o(u)&&i.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(u).then((function(e){d.value=e,s(d)}),(function(e){return n("throw",e,s,c)}))}c(l.arg)}var a;s(this,"_invoke",{value:function(e,o){function r(){return new t((function(t,a){n(e,o,t,a)}))}return a=a?a.then(r,r):r()}})}function z(e,n,o){var a=f;return function(r,i){if(a===v)throw new Error("Generator is already running");if(a===y){if("throw"===r)throw i;return{value:t,done:!0}}for(o.method=r,o.arg=i;;){var s=o.delegate;if(s){var c=P(s,o);if(c){if(c===w)continue;return c}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(a===f)throw a=y,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a=v;var l=h(e,n,o);if("normal"===l.type){if(a=o.done?y:p,l.arg===w)continue;return{value:l.arg,done:o.done}}"throw"===l.type&&(a=y,o.method="throw",o.arg=l.arg)}}}function P(e,n){var o=n.method,a=e.iterator[o];if(a===t)return n.delegate=null,"throw"===o&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==o&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+o+"' method")),w;var r=h(a,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,w;var i=r.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,w):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,w)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function D(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var n=e[l];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,r=function n(){for(;++a<e.length;)if(i.call(e,a))return n.value=e[a],n.done=!1,n;return n.value=t,n.done=!0,n};return r.next=r}}throw new TypeError(o(e)+" is not iterable")}return C.prototype=x,s(I,"constructor",{value:x,configurable:!0}),s(x,"constructor",{value:C,configurable:!0}),C.displayName=m(x,u,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===C||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,m(e,u,"GeneratorFunction")),e.prototype=Object.create(I),e},n.awrap=function(e){return{__await:e}},T(k.prototype),m(k.prototype,d,(function(){return this})),n.AsyncIterator=k,n.async=function(e,t,o,a,r){void 0===r&&(r=Promise);var i=new k(g(e,t,o,a),r);return n.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},T(I),m(I,u,"Generator"),m(I,l,(function(){return this})),m(I,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),n=[];for(var o in t)n.push(o);return n.reverse(),function e(){for(;n.length;){var o=n.pop();if(o in t)return e.value=o,e.done=!1,e}return e.done=!0,e}},n.values=N,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(D),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(o,a){return s.type="throw",s.arg=e,n.next=o,a&&(n.method="next",n.arg=t),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var r=this.tryEntries[a],s=r.completion;if("root"===r.tryLoc)return o("end");if(r.tryLoc<=this.prev){var c=i.call(r,"catchLoc"),l=i.call(r,"finallyLoc");if(c&&l){if(this.prev<r.catchLoc)return o(r.catchLoc,!0);if(this.prev<r.finallyLoc)return o(r.finallyLoc)}else if(c){if(this.prev<r.catchLoc)return o(r.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return o(r.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&i.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var r=a?a.completion:{};return r.type=e,r.arg=t,a?(this.method="next",this.next=a.finallyLoc,w):this.complete(r)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),w},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),D(n),w}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var o=n.completion;if("throw"===o.type){var a=o.arg;D(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,o){return this.delegate={iterator:N(e),resultName:n,nextLoc:o},"next"===this.method&&(this.arg=t),w}},n}e.exports=a,e.exports.__esModule=!0,e.exports.default=e.exports},698:e=>{function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},687:(e,t,n)=>{var o=n(61)();e.exports=o;try{regeneratorRuntime=o}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=o:Function("r","regeneratorRuntime = r")(o)}}},t={};function n(o){var a=t[o];if(void 0!==a)return a.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";function e(e,t,n,o,a,r,i){try{var s=e[r](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(o,a)}function t(t){return function(){var n=this,o=arguments;return new Promise((function(a,r){var i=t.apply(n,o);function s(t){e(i,a,r,s,c,"next",t)}function c(t){e(i,a,r,s,c,"throw",t)}s(void 0)}))}}var o=n(687),a=n.n(o),r="basedonurl",i={defaults:{minwidth:0,minheight:0,urlpattern:"",savefoldername:r,donotbother:!1,numviews:0,allframes:!1,biggerview:!0,twocols:!0,newshown1:!1,savesize:!1,sizetype:"any",doNotShowCopyright:!1,displayMode:"sidePanel",sort:"pixels",savefilename:"",savedownloadoptions:!0,convertfrom:"",convertto:"jpeg"}};for(var s in i.defaults)i[s]=i.defaults[s];var c={darkmode:window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,imageCT:new Object,allimages:new Object,downloadingErrorItems:[],redirectRequests:[],imagesCT:[],canDisplayInSidePanel:!1,stats:{types:{},sizes:{}},getImages:function(e){c.initiated=!1;var t=i.allframes;t&&(t=!e),c.allimages=new Object;var n='<div id="spinner" class="spinner"><span id="processedImages" style="position: absolute;top: -38px;left: 50%;transform:translateX(-50%);white-space:nowrap;"></span><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>';$("#imgsContainer")[0].innerHTML.trim()!=n&&($("#imgsContainer")[0].innerHTML=n),chrome.tabs.query({active:!0,currentWindow:!0},(function(e){var n=e[0];if(!n||n.favIconUrl||n.title||n.url)c.currUrl=n.url,chrome.scripting.executeScript({target:{tabId:n.id,allFrames:t},files:["imageScraper.js"]},(function(e){c.getImagesCallback(e)}));else{var o=[{documentId:null,frameId:null,result:{images:[chrome.runtime.getURL("onboarding_1.jpg"),chrome.runtime.getURL("onboarding_2.jpg"),chrome.runtime.getURL("onboarding_3.jpg"),chrome.runtime.getURL("onboarding_4.jpg")],isArc:"",isTop:!0,origin:"",title:""}}];c.getImagesCallback(o)}}))},getImagesCallback:function(e){return t(a().mark((function t(){var n,o,r,s,l,d,u,m,g;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!c.initiated){t.next=2;break}return t.abrupt("return");case 2:if(c.initiated=!0,!chrome.runtime.lastError&&e){t.next=19;break}n=chrome.runtime.lastError?chrome.runtime.lastError.message:"Cannot access images in this page.",chrome.runtime.lastError.message&&($("#imgsContainer")[0].style.padding="0px 20px",$("#imgsContainer")[0].style.position="relative",n='<div style="width:387px;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="512" height="512" x="0" y="0" viewBox="0 0 201.526 201.526" style="enable-background:new 0 0 512 512;width: 65px;height: 65px;float: left;" xml:space="preserve" class=""><g><path d="M191.125,11.403H10.4C4.666,11.403,0,16.068,0,21.805v59.108c0,5.738,4.666,10.404,10.4,10.404h180.726     c5.734,0,10.4-4.666,10.4-10.403V21.805C201.525,16.068,196.86,11.403,191.125,11.403z M194.577,80.914h-0.001     c0,1.903-1.547,3.454-3.451,3.454H10.4c-1.904,0-3.451-1.551-3.451-3.454V21.805c0-1.903,1.547-3.454,3.451-3.454h180.726     c1.903,0,3.451,1.551,3.451,3.454V80.914z" fill="#333333" data-original="#000000" style="" class=""></path><path d="M63.924,35.968c-1.751-0.801-3.807-0.027-4.605,1.714L48.821,60.606l-3.19-6.696l6.109-13.338     c0.797-1.744,0.034-3.807-1.714-4.605c-1.751-0.801-3.811-0.027-4.605,1.714l-3.687,8.051l-3.859-8.099     c-0.825-1.734-2.888-2.477-4.628-1.642c-1.734,0.825-2.47,2.898-1.642,4.628l6.358,13.347l-3.04,6.638l-10.947-22.97     c-0.821-1.734-2.888-2.477-4.628-1.642c-1.734,0.825-2.47,2.898-1.642,4.628l14.143,29.686c0.573,1.211,1.795,1.982,3.135,1.982     c0.01,0,0.017,0,0.027,0c1.347-0.01,2.569-0.801,3.132-2.029l3.716-8.113l3.888,8.161c0.573,1.211,1.795,1.982,3.135,1.982     c0.01,0,0.017,0,0.027,0c1.347-0.01,2.569-0.801,3.132-2.029l13.596-29.686C66.434,38.83,65.671,36.766,63.924,35.968z" fill="#333333" data-original="#000000" style="" class=""></path><path d="M122.991,35.968c-1.754-0.801-3.807-0.027-4.605,1.714l-10.498,22.924l-3.19-6.696l6.109-13.338     c0.797-1.744,0.034-3.807-1.714-4.605c-1.751-0.801-3.807-0.027-4.604,1.714l-3.687,8.051l-3.859-8.099     c-0.821-1.734-2.891-2.477-4.628-1.642c-1.734,0.825-2.47,2.898-1.642,4.628l6.358,13.347l-3.04,6.638l-10.947-22.97     c-0.821-1.734-2.891-2.477-4.628-1.642c-1.734,0.825-2.47,2.898-1.642,4.628l14.143,29.686c0.573,1.211,1.795,1.982,3.135,1.982     c0.01,0,0.017,0,0.027,0c1.347-0.01,2.569-0.801,3.132-2.029l3.716-8.113l3.888,8.161c0.573,1.211,1.795,1.982,3.135,1.982     c0.01,0,0.017,0,0.027,0c1.347-0.01,2.569-0.801,3.132-2.029l13.596-29.686C125.502,38.83,124.739,36.766,122.991,35.968z" fill="#333333" data-original="#000000" style="" class=""></path><path d="M182.059,35.968c-1.751-0.801-3.807-0.027-4.605,1.714l-10.498,22.924l-3.19-6.696l6.109-13.338     c0.797-1.744,0.034-3.807-1.714-4.605c-1.751-0.801-3.807-0.027-4.605,1.714l-3.687,8.051l-3.859-8.099     c-0.821-1.734-2.888-2.477-4.628-1.642c-1.734,0.825-2.47,2.898-1.642,4.628l6.358,13.347l-3.04,6.638l-10.946-22.971     c-0.821-1.734-2.888-2.477-4.628-1.642c-1.734,0.825-2.47,2.898-1.642,4.628l14.143,29.686c0.573,1.211,1.795,1.982,3.135,1.982     c0.01,0,0.017,0,0.027,0c1.347-0.01,2.569-0.801,3.132-2.029l3.716-8.113l3.888,8.161c0.573,1.211,1.795,1.982,3.135,1.982     c0.01,0,0.017,0,0.027,0c1.347-0.01,2.569-0.801,3.132-2.029l13.596-29.686C184.57,38.83,183.806,36.766,182.059,35.968z" fill="#333333" data-original="#000000" style="" class=""></path><path d="M183.461,140.316L130.3,97.208c-1.065-0.865-2.545-1.018-3.766-0.397c-1.222,0.621-1.965,1.907-1.893,3.278l3.627,68.345     c0.078,1.455,1.055,2.708,2.45,3.139c1.384,0.421,2.904-0.061,3.787-1.222c0.065-0.081,5.398-7.075,11.231-12.901l15.68,30.776     c0.417,0.821,1.143,1.442,2.022,1.727c0.35,0.112,0.713,0.17,1.072,0.17c0.543,0,1.086-0.129,1.578-0.38l12.385-6.311     c0.821-0.417,1.442-1.143,1.727-2.022c0.285-0.876,0.21-1.829-0.21-2.65l-15.68-30.772c8.14-1.293,16.932-1.5,17.037-1.5     c1.455-0.034,2.742-0.97,3.213-2.348C185.031,142.759,184.594,141.232,183.461,140.316z M158.337,142.055     c-1.045,0.238-1.92,0.943-2.375,1.914c-0.451,0.97-0.434,2.097,0.054,3.05l16.206,31.8l-6.192,3.156l-16.206-31.804     c-0.485-0.953-1.384-1.632-2.436-1.832c-0.217-0.044-0.438-0.065-0.658-0.065c-0.831,0-1.646,0.298-2.283,0.859     c-3.444,3.003-6.926,6.756-9.715,9.972l-2.734-51.576l40.117,32.53C167.876,140.426,162.793,141.037,158.337,142.055z" fill="#333333" data-original="#000000" style="" class=""></path></g></svg><div style="float: left;padding-left: 15px;width:300px;">Visit a website and you will be able to find and download all the images...</div></div>',n='\n                Welcome to <b>Imageye extension</b>.<br>\n                <br>\n                This extension operates on most websites except for ones where the browser restricts scripting, including the extension web store, browser settings pages, and other extensions.<br>\n                <br>\n                Why not take it for a spin somewhere else, for example try <a href="#" class="trythisone">this one</a>. Have fun! &#129321;<br>\n                <br>\n                <span style="color:gray">'.concat(chrome.runtime.lastError.message,"</span>\n                ")),(o=document.createElement("div")).innerHTML="<div style='font-size:15px;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:70%;max-width:300px;margin-top:-20px;'>".concat(n,"</center>"),o.style.width="100%",o.style.height="100%",$("#imgsContainer")[0].appendChild(o),document.querySelector(".trythisone").onclick=function(){chrome.tabs.query({active:!0,currentWindow:!0},(function(e){var t=e[0];chrome.tabs.update(t.id,{url:"https://www.google.com/search?tbm=isch&q=puppies"},(function(){setTimeout((function(){document.location.reload()}),1e3)}))}))},document.querySelector("#numimagesfound span").innerHTML=document.querySelectorAll(".imgContainer:not(.excluded)").length,document.getElementById("spinner").style.display="none",document.getElementById("searchingimages").style.display="none",document.getElementById("numimagesfound").style.display="",document.getElementById("selectalla").style.visibility="visible",t.next=53;break;case 19:for(e[0]&&e[0].result&&e[0].result.isArc&&(c.canDisplayInSidePanel=!1,document.querySelector(".displayInSidePanelPref").style.display="none","popup"!=i.displayMode&&(console.log("detected ARC browser, changing display mode to popup"),chrome.tabs.query({active:!0,currentWindow:!0},(function(e){chrome.runtime.sendMessage({msg:"changeDisplayMode",tabId:e[0].id,displayMode:"popup"},(function(){}))})))),r=0,s=0;s<e.length;s++)null!=e[s]&&null!=e[s].result.images&&e[s].result.images.length>0&&(r+=e[s].result.images.length);if(0!=r){t.next=26;break}return c.foundlastimage(),t.abrupt("return");case 26:(l=document.createElement("div")).id="loadingBack",l.className="disableBackround",l.style.top="".concat($("#imgsContainer").offset().top,"px"),(d=document.createElement("div")).innerHTML="analyzing 0 of ".concat(r," images"),d.className="progressText",d.style.width="auto",l.appendChild(d),$("#imgsContainer")[0].appendChild(l);try{for(s=0;s<e.length;s++)null!=e[s]&&e[s].result&&e[s].result.isTop&&(u=e[s].result.origin)}catch(e){console.log(e)}c.addReferrerRules(u),s=0;case 39:if(!(s<e.length)){t.next=53;break}if(null!=e[s]&&null!=e[s].result.images){t.next=42;break}return t.abrupt("continue",50);case 42:return m=e[s].result.images,e[s].result.isTop&&(c.title=e[s].result.title),(g=document.createElement("div")).className="advContainer",g.innerHTML="<img class='origImg' src='https://d2h7hm4130kene.cloudfront.net/__1621004410__/images/zone/1_big_q90.webp'><br><div class='imgInfo'><div class='imgSize imgDimension' style='margin-left:5px;'>Sponsored</div></div></div>",t.next=49,c.addImages(m,r);case 49:c.foundlastimage();case 50:s++,t.next=39;break;case 53:console.log("\n          ----------------------------------------------------------------------------------------------------\n          COPYRIGHT (C) 2023 IMAGEYE\n\n          This source code is protected under Registered Copyright Ref Number: 19514190123S022. Any reproduction,\n          modification, distribution, or republication of this code, or any part thereof is strictly prohibited.\n\n          This code includes proprietary and confidential information. Any use of this code,\n          or any 'look and feel' components derived from it, is illegal and will result in legal action.\n\n          In the event of unauthorized use or infringement, we reserve the right to take legal action \n          to the maximum extent possible under the law, including criminal prosecution.\n          ----------------------------------------------------------------------------------------------------\n        ");case 54:case"end":return t.stop()}}),t)})))()},addImages:function(e,n){return t(a().mark((function o(){var r,i,s;return a().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return s=function(){return(s=t(a().mark((function t(){var o,s,l;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=[],e.length){t.next=3;break}return t.abrupt("return");case 3:for(s=0;s<30;s++)(l=e.pop())&&o.push({image:l,index:e.length}),n&&$(".progressText")[0]&&($(".progressText")[0].innerHTML="analyzing ".concat(n-e.length," of ").concat(n," images"));return t.next=6,Promise.all(o.map((function(e){return r(c.addImage(e.image,!1,e.index),2e3).catch((function(e){}))})));case 6:return t.next=8,i();case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)},i=function(){return s.apply(this,arguments)},c.initCTListeners(),r=function(e,t){return Promise.race([e,new Promise((function(e,n){return setTimeout(n,t)}))])},o.next=6,i();case 6:case"end":return o.stop()}}),o)})))()},addImage:function(e,n,o){return t(a().mark((function r(){return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise((function(r,s){try{c.allimages[e]&&r(!1),c.allimages[e]=e;var l=document.createElement("img");l.src=e,l.style.maxWidth="600px",l.className="origImg",l.id=e,l.setAttribute("index",o),l.onerror=t(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r(!1);case 1:case"end":return e.stop()}}),e)}))),l.onload=function(){var e=t(a().mark((function e(t){var o,s,l,d,u,m,g,h,f,p,v,y,w,b,C;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,t.target.style.maxWidth="",o=t.target.src,s=t.target.getAttribute("index"),(l=document.createElement("div")).className="imgContainer",d=t.target.width,u=t.target.height,m=d*u,l.setAttribute("pixels",m),l.setAttribute("width",d),l.setAttribute("height",u),l.setAttribute("index",s),m<4e4&&l.setAttribute("sizeType","small"),m>=4e4&&l.setAttribute("sizeType","medium"),m>=48e4&&l.setAttribute("sizeType","large"),d>=1.2*u?l.setAttribute("layout","wide"):u>=1.2*d?l.setAttribute("layout","tall"):l.setAttribute("layout","square"),g=o,-1!=o.indexOf("data:image/")&&(g="".concat(o.substring(0,50),"...").concat(o.substring(o.length-50,o.length))),(h=document.createElement("input")).className="imgInput",h.value=g,f=c.getImgType(o),l.setAttribute("type",f),(p=document.createElement("div")).className="imgInfo",p.innerHTML="\n                            <div class='imgSize imgDimension' style='margin-left:5px;'>-</div>\n                            <div class='imgSize'>".concat(t.target.width,"x").concat(t.target.height,"</div>\n                            <div class='imgSize imgType' style='margin-right:5px;'>").concat(f,"</div>\n                            <div class='imgActions'>\n                                <input type='checkbox'>\n                                <img class='zoomIcon' title=\"").concat(chrome.i18n.getMessage("openinnewtab"),'" src=\'/newtab.png\' />\n                                <span class="showTooltipOnHover">\n                                    <img class=\'zoomIcon downloadIcon\' src=\'data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTguMS4xLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDI5Ljk3OCAyOS45NzgiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDI5Ljk3OCAyOS45Nzg7IiB4bWw6c3BhY2U9InByZXNlcnZlIiB3aWR0aD0iMjRweCIgaGVpZ2h0PSIyNHB4Ij4KPGc+Cgk8cGF0aCBkPSJNMjUuNDYyLDE5LjEwNXY2Ljg0OEg0LjUxNXYtNi44NDhIMC40ODl2OC44NjFjMCwxLjExMSwwLjksMi4wMTIsMi4wMTYsMi4wMTJoMjQuOTY3YzEuMTE1LDAsMi4wMTYtMC45LDIuMDE2LTIuMDEyICAgdi04Ljg2MUgyNS40NjJ6IiBmaWxsPSIjMDAwMDAwIi8+Cgk8cGF0aCBkPSJNMTQuNjIsMTguNDI2bC01Ljc2NC02Ljk2NWMwLDAtMC44NzctMC44MjgsMC4wNzQtMC44MjhzMy4yNDgsMCwzLjI0OCwwczAtMC41NTcsMC0xLjQxNmMwLTIuNDQ5LDAtNi45MDYsMC04LjcyMyAgIGMwLDAtMC4xMjktMC40OTQsMC42MTUtMC40OTRjMC43NSwwLDQuMDM1LDAsNC41NzIsMGMwLjUzNiwwLDAuNTI0LDAuNDE2LDAuNTI0LDAuNDE2YzAsMS43NjIsMCw2LjM3MywwLDguNzQyICAgYzAsMC43NjgsMCwxLjI2NiwwLDEuMjY2czEuODQyLDAsMi45OTgsMGMxLjE1NCwwLDAuMjg1LDAuODY3LDAuMjg1LDAuODY3cy00LjkwNCw2LjUxLTUuNTg4LDcuMTkzICAgQzE1LjA5MiwxOC45NzksMTQuNjIsMTguNDI2LDE0LjYyLDE4LjQyNnoiIGZpbGw9IiMwMDAwMDAiLz4KCTxnPgoJPC9nPgoJPGc+Cgk8L2c+Cgk8Zz4KCTwvZz4KCTxnPgoJPC9nPgoJPGc+Cgk8L2c+Cgk8Zz4KCTwvZz4KCTxnPgoJPC9nPgoJPGc+Cgk8L2c+Cgk8Zz4KCTwvZz4KCTxnPgoJPC9nPgoJPGc+Cgk8L2c+Cgk8Zz4KCTwvZz4KCTxnPgoJPC9nPgoJPGc+Cgk8L2c+Cgk8Zz4KCTwvZz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8L3N2Zz4K\' />\n                                    <div class="tooltip downloadImgAction">\n                                        <p style="padding-top:10px;"><b>Download as:</b></p>\n                                        <p class="download-type" dtype="original">Original (').concat(f,')</p>\n                                        <p class="download-type" dtype="jpeg">JPEG</p>\n                                        <p class="download-type" dtype="png">PNG</p>\n                                        <p class="download-type" dtype="webp">WEBP</p>\n                                    </div>\n                                </span>\n                                ').concat(0!=o.toLowerCase().indexOf("http")?"":"<img class='zoomIcon searchsimilarimgs' title='".concat(chrome.i18n.getMessage("searchsimilarimgs"),"' src='/searchsimilarimgs.png' />"),"\n                            </div>\n                        "),l.appendChild(t.target),l.appendChild(h),l.appendChild(p),l.setAttribute("imgsrc",o),v=document.getElementsByClassName("imgContainer"),y=!1,e.prev=33,w=0;case 35:if(!(w<v.length)){e.next=50;break}if("pixels"!=i.sort){e.next=43;break}if(!(parseInt(m)>parseInt(v[w].getAttribute("pixels")))){e.next=41;break}return $(v[w]).before(l),y=!0,e.abrupt("break",50);case 41:e.next=47;break;case 43:if(!(parseInt(s)<parseInt(v[w].getAttribute("index")))){e.next=47;break}return $(v[w]).before(l),y=!0,e.abrupt("break",50);case 47:w++,e.next=35;break;case 50:e.next=54;break;case 52:e.prev=52,e.t0=e.catch(33);case 54:if(y||document.getElementById("imgsContainer").appendChild(l),l.style.display="-webkit-box",t.target.width>d&&(t.target.width=d),l.onclick=function(e){"imgInput"!=e.target.className&&("zoomIcon"!=e.target.className?"zoomIcon searchsimilarimgs"!=e.target.className?"zoomIcon downloadIcon"!=e.target.className&&"zoomIcon downloadIcon"!=e.target.className?"download-type"!=e.target.className?c.selectImg(this):c.downloadImages([this.getAttribute("imgsrc")],e.target.getAttribute("dtype")):c.downloadImages([this.getAttribute("imgsrc")]):chrome.tabs.create({url:" https://lens.google.com/uploadbyurl?url=".concat(encodeURIComponent(o)),active:!0}):chrome.tabs.create({url:o,active:"sidePanel"==i.displayMode}))},n&&l.scrollIntoView(),0==o.indexOf("data:image/")){b=o;try{C=o.split(",").pop(),b=atob(C)}catch(e){}l.querySelector(".imgDimension").innerHTML=c.formatBytes(b.length,0)}$("#imgsContainer").attr("finished")&&c.populateStats(),r(!0),e.next=67;break;case 64:e.prev=64,e.t1=e.catch(0),r(!1);case 67:case"end":return e.stop()}}),e,null,[[0,64],[33,52]])})));return function(t){return e.apply(this,arguments)}}()}catch(e){console.log("addImage error + ".concat(e)),r(!1)}})));case 1:case"end":return r.stop()}}),r)})))()},selectImg:function(e,t,n){var o=e.querySelector('input[type="checkbox"]');(t?n:!e.classList.contains("imgSelected"))?(o.checked="checked",e.classList.add("imgSelected")):(o.checked="",e.classList.remove("imgSelected"));var a=$(".imgContainer:not(.excluded)"),r=$(".imgContainer.imgSelected:not(.excluded)").length;0==r?($("#downloadButton")[0].style.display="none",$("#foundimagesinnerdiv")[0].style.display=""):($("#downloadButton label")[0].innerHTML=chrome.i18n.getMessage("manyfilesnum").replace("%n",r),$("#downloadButton")[0].style.display="",$("#foundimagesinnerdiv")[0].style.display="none"),$("#selectalla")[0].innerHTML=a.length==r?chrome.i18n.getMessage("deselectall"):chrome.i18n.getMessage("selectall")},showPrefs:function(){document.body.classList.contains("showPrefs")?document.body.classList.remove("showPrefs"):($("#donotbother")[0].checked=!!i.donotbother,$("#allframes")[0].checked=!!i.allframes,$("#biggerview")[0].checked=!!i.biggerview,$("#twocols")[0].checked=!!i.twocols,$("#displayInSidePanel")[0].checked="sidePanel"==i.displayMode,$("#downloadseparatefolder").prop("checked",i.savedownloadoptions),i.savedownloadoptions?$("#downloadocationcontainer").show():$("#downloadocationcontainer").hide(),$("#savefoldernamePrefs").val(i.savefoldername),$("#savefilenamePrefs").val(i.savefilename),$("#convertFromPrefs").val(i.convertfrom),$("#convertToPrefs").val(i.convertto),$("#openHotKeyPrefs")[0].onclick=function(e){e.preventDefault(),chrome.tabs.create({url:"chrome://extensions/shortcuts",active:!0}),setTimeout(c.showPrefs,500)},chrome.commands.getAll((function(e){var t=e[0].shortcut;$("#openHotKeyPrefs")[0].innerHTML=t||"Not set"})),document.body.classList.add("showPrefs"),chrome.storage.sync.set({newshown1:!0}))},savePrefs:function(){i.donotbother=$("#donotbother")[0].checked,i.biggerview=$("#biggerview")[0].checked,i.twocols=$("#twocols")[0].checked,i.allframes=$("#allframes")[0].checked;var e=$("#displayInSidePanel")[0].checked?"sidePanel":"popup",t=e!=i.displayMode;i.displayMode=e,chrome.storage.sync.set({donotbother:i.donotbother,biggerview:i.biggerview,twocols:i.twocols,allframes:i.allframes,displayMode:i.displayMode}),c.saveDownloadOptionsFromPrefs(),document.body.classList.remove("showPrefs"),t&&chrome.tabs.query({active:!0,currentWindow:!0},(function(e){var t=e[0];chrome.runtime.sendMessage({msg:"changeDisplayMode",tabId:t.id,displayMode:i.displayMode},(function(){window.close()}))}))},showRating:function(){document.body.classList.contains("showRating")?document.body.classList.remove("showRating"):document.body.classList.add("showRating")},openRatingTab:function(){window.open("https://chromewebstore.google.com/detail/image-downloader-imageye/agionbommeaifngbhincahgmoflcikhm/reviews")},downloadImage:function(e,t){console.log("downloadImage: url [".concat(e,"] forceType [").concat(t,"]"));var n=c.getImgType(e);return"original"==t||!t&&$("#convertFrom").val()!=n&&"ALL"!=$("#convertFrom").val()?chrome.downloads.download({url:e,conflictAction:"uniquify"}):new Promise((function(n,o){var a=new Image;a.crossOrigin="Anonymous",a.addEventListener("load",(function(){return n(a)})),a.addEventListener("error",(function(e){return o(e)})),a.src=e,a.convertToType=t||$("#convertTo").val()})).then((function(e){return new Promise((function(t,n){var o=document.createElement("canvas");o.width=e.naturalWidth,o.height=e.naturalHeight,o.getContext("2d").drawImage(e,0,0),t({dataUrl:o.toDataURL("image/".concat(e.convertToType)),image:e})}))})).then((function(e){var t=e.dataUrl,n=e.image;return new Promise((function(e,o){var a="download";-1==n.src.indexOf("data:")&&-1!=(a=(a=decodeURI(n.src)).split("/").pop().split("?")[0].split("#")[0]).lastIndexOf(".")&&(a=a.substring(0,a.lastIndexOf("."))),a="".concat(a,".").concat(n.convertToType);var r=document.createElement("a");r.download="imageye___-_".concat(a),r.href=t,r.click(),setTimeout((function(){return e()}),100)}))})).catch((function(e){return console.log("error while converting image"),!1}))},removeReferrersRules:function(){return t(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,chrome.declarativeNetRequest.updateSessionRules({removeRuleIds:[12345344]});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.log(e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})))()},addReferrerRules:function(e){return t(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c.removeReferrersRules(),e=e||c.active_tab_origin,c.active_tab_origin=e,t.prev=3,!e){t.next=7;break}return t.next=7,chrome.declarativeNetRequest.updateSessionRules({addRules:[{id:12345344,priority:1,action:{type:"modifyHeaders",requestHeaders:[{header:"Referer",operation:"set",value:e}]},condition:{urlFilter:"|http*",resourceTypes:["image"],initiatorDomains:[chrome.runtime.id]}}]});case 7:t.next=12;break;case 9:t.prev=9,t.t0=t.catch(3),console.log(t.t0);case 12:case"end":return t.stop()}}),t,null,[[3,9]])})))()},downloadImages:function(e,n){return t(a().mark((function t(){var o,s,l,d,u,m,g,h,f;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:c.addReferrerRules(),o={filename:$("#savefilename").val(),foldername:$("#savefoldername").val()==r?c.title:$("#savefoldername").val()},chrome.runtime.sendMessage({msg:"setDownloadOptions",downloadOptions:o},(function(){})),s=e&&1==e.length,i.doNotShowCopyright,e||(e=[],document.querySelectorAll(".imgContainer:not(.excluded).imgSelected").forEach((function(t){e.push(t.getAttribute("imgsrc"))}))),(l=document.createElement("div")).className="disableBackround",d=document.createElement("progress"),(u=document.createElement("div")).className="progressText",(m=document.createElement("div")).innerHTML="do not leave this page until complete",m.style.fontSize="14px",m.className="progressText",m.style.marginTop="22px",l.appendChild(d),l.appendChild(u),l.appendChild(m),(g=document.createElement("div")).className="progressText",g.style.marginTop="0px",g.style.bottom="0px",g.style.top="auto",g.style.fontSize="14px",g.innerHTML="The images you are downloading may be protected by copyright. Before using an image, make sure you check its license and the specific terms of reuse.",l.appendChild(g),document.body.appendChild(l),d.max=e.length,h=0;case 30:if(!(h<e.length)){t.next=38;break}return t.next=33,Promise.race([c.downloadImage(e[h],n),new Promise((function(e,t){return setTimeout(e,3e3)}))]);case 33:d.value=h+1,u.innerHTML="downloading image ".concat(h+1," of ").concat(e.length);case 35:h++,t.next=30;break;case 38:if(u.innerHTML="Download complete!",m.style.display="none",(f=document.createElement("div")).className="progressText downloadButton",f.style.marginTop="40px",f.style.width="auto",f.style.paddingLeft=f.style.paddingRight="26px",f.innerHTML="Close",l.appendChild(f),!i.doNotShowCopyright||!s){t.next=54;break}return f.style.display="none",t.next=51,new Promise((function(e){return setTimeout(e,400)}));case 51:l.remove(),t.next=55;break;case 54:f.onclick=l.onclick=function(){i.doNotShowCopyright||(chrome.storage.sync.set({doNotShowCopyright:!0}),i.doNotShowCopyright=!0),l.remove()};case 55:setTimeout(c.removeReferrersRules,1e4);case 56:case"end":return t.stop()}}),t)})))()},init:function(){if(chrome.tabs.onUpdated.addListener((function(e,t,n){t.url&&n.id===c.tabid&&document.location.reload()})),document.body.classList.add(i.displayMode),c.canDisplayInSidePanel||(document.querySelector(".displayInSidePanelPref").style.display="none"),i.biggerview&&$("#container").addClass("bigger"),i.newshown1&&$("body").addClass("newshown1"),i.twocols&&$("#container").addClass("twocols"),c.localize(),c.initSizeMenu(),c.initSortMenu(),c.getImages(),chrome.downloads.onChanged.addListener((function(e){chrome.tabs.query({active:!0,currentWindow:!0},(function(t){c.tabid==t[0].id&&chrome.downloads.search({id:e.id},(function(e){var t=e[0];if(t.byExtensionId==chrome.runtime.id&&t.error&&!t.canResume){if(c.downloadingErrorItems[t.id]||"USER_CANCELED"==t.error)return;console.log("error downloading ".concat(t.id,", image ").concat(t.url," will retry with conversion...")),c.downloadingErrorItems[t.id]=!0;var n=new Image;n.crossOrigin="Anonymous",n.src=t.url,n.onload=function(){var e=document.createElement("canvas");e.width=n.naturalWidth,e.height=n.naturalHeight,e.getContext("2d").drawImage(n,0,0);var t=e.toDataURL("image/jpeg");chrome.downloads.download({url:t,conflictAction:"uniquify"})}}}))}))})),$(".showDownloadOptions svg").on("click",(function(e){if($(".showDownloadOptions .downloadMenu").is(":visible"))return $(".showDownloadOptions .downloadMenu").hide(),c.saveDownloadOptions(),void $(".downloadMenuCover").remove();$(".showDownloadOptions .downloadMenu").show();var t=document.querySelector(".downloadMenuCover");t&&t.remove(),(t=document.createElement("div")).className="downloadMenuCover",$("#downloadButton").before(t),t.onclick=function(e){c.saveDownloadOptions(),$(".showDownloadOptions .downloadMenu").hide(),t.remove()}})),$(".savedownloadoptions").on("click",(function(e){$(".savedownloadoptions").hasClass("selected")?$(".savedownloadoptions").removeClass("selected"):$(".savedownloadoptions").addClass("selected")})),$("#downloadseparatefolder").on("change",(function(e){this.checked?$("#downloadocationcontainer").show():$("#downloadocationcontainer").hide()})),$("#savefoldername").val(i.defaults.savefoldername),$("#savefilename").val(i.defaults.savefilename),i.savedownloadoptions){var e=i.savefoldername;e!=i.defaults.savefoldername&&(e=sanitize(e,{replacement:"_"})),$("#savefoldername").val(e);var t=sanitize(i.savefilename,{replacement:"_"});$("#savefilename").val(t),$("#convertFrom").val(i.convertfrom),$("#convertTo").val(i.convertto)}i.savedownloadoptions?$(".savedownloadoptions").addClass("selected"):$(".savedownloadoptions").removeClass("selected"),c.setDownloadOptionsChanged(),$("#reloadImageye")[0].onclick=function(){document.location.reload()},$("#showPrefs")[0].onclick=c.showPrefs,$("#saveprefscancel")[0].onclick=c.showPrefs,$("#saveprefs")[0].onclick=c.savePrefs,$("#saveaslink")[0].onclick=function(){event.preventDefault(),chrome.tabs.create({url:"chrome://settings/downloads",active:!0})},$("#biggerview")[0].onclick=function(){$("#biggerview")[0].checked?$("#container").addClass("bigger"):$("#container").removeClass("bigger")},$("#twocols")[0].onclick=function(){$("#twocols")[0].checked?$("#container").addClass("twocols"):$("#container").removeClass("twocols")},document.querySelector(".twoColsPref").onclick=function(){i.twocols=!i.twocols,i.twocols?$("#container").addClass("twocols"):$("#container").removeClass("twocols"),chrome.storage.sync.set({twocols:i.twocols})},$("#selectalla")[0].onclick=function(){var e=$(".imgContainer:not(.excluded)"),t=$(".imgContainer.imgSelected:not(.excluded)").length,n=e.length!=t;e.each((function(){c.selectImg(this,!0,n)}))},$(".showDownloadOptions")[0].onclick=function(e){e.stopPropagation(),e.preventDefault()},$("#downloadButton")[0].onclick=function(){$(".showDownloadOptions .downloadMenu").is(":visible")&&($(".showDownloadOptions .downloadMenu").hide(),c.saveDownloadOptions(),$(".downloadMenuCover").remove());var e=$(".imgContainer.imgSelected:not(.excluded)").length;if(e>2&&!i.donotbother)return-1!=navigator.userAgent.indexOf("Firefox")&&(chromemanyfileswarning.style.display="none",firefoxmanyfileswarning.style.display="block"),$("#manyfilesnum")[0].innerHTML=$("#manyfilesnum")[0].innerHTML.replace("%n",e),$("#manyfiles")[0].style.display="block",$("#manyfilesdownload")[0].onclick=function(){i.donotbother=$("#donotbotherme")[0].checked,chrome.storage.sync.set({donotbother:i.donotbother}),c.downloadImages(),$("#manyfiles")[0].style.display="none"},$("#manyfilescancel")[0].onclick=function(){$("#manyfiles")[0].style.display="none"},void($("#donotbotherme")[0].checked=!1);c.downloadImages()},$("#filterbyurlinput").on("input",(function(e){var t=this.value,n=$(e.target).closest(".filters > div").find(".menuLabel");n.html("URL"),n.removeClass("changedMenu"),t&&(n.html(t),n.addClass("changedMenu")),13===e.keyCode&&$(e.target).closest(".selectMenu").hide(),c.inputtimeout&&clearTimeout(c.inputtimeout),c.inputtimeout=setTimeout((function(){i.urlpattern=t,c.foundlastimage()}),300)})),$("#ratebutton")[0].onclick=c.openRatingTab,$("#rateclose")[0].onclick=c.showRating,$(".filters > div div[saveSize]").on("click",(function(e){var t=$(this);i.savesize?(i.savesize=!1,t.removeClass("selected"),c.saveSizeConf(!0)):(i.savesize=!0,t.addClass("selected"),c.saveSizeConf()),chrome.storage.sync.set({savesize:i.savesize})})),$(".filters > div").on("mousedown",(function(e){var t=$(this).find(".selectMenu");t.show(),t[0].style.marginLeft="0px";var n=c.getAbsolutePosition(t[0]),o=n.left+n.width-document.querySelector("#container").offsetWidth;o>0&&(t[0].style.marginLeft="".concat(-o,"px"))})),$(document.body).on("mousedown",(function(e){$(".filters div").each((function(){var t=this,n=t==e.target;$(e.target).parents().each((function(){this==t&&(n=!0)})),n||$(t).find(".selectMenu").hide()}))})),$(".sizeMenu").on("click",(function(e){var t=$(e.target).attr("sizeConf");if(t&&(i.sizetype=t,"custom"!=t)){$(this).find("div[sizeConf]").each((function(){$(this).removeClass("selected")})),i.minwidth=i.defaults.minwidth,i.minheight=i.defaults.minheight,$("#minwidthinput").val(i.minwidth),$("#minheightinput").val(i.minheight);var n=$(e.target).closest(".filters > div").find(".menuLabel");n.removeClass("changedMenu"),n.html("Size"),"any"!=t&&(n.addClass("changedMenu"),n.html(t.charAt(0).toUpperCase()+t.slice(1))),$(e.target).addClass("selected"),c.foundlastimage(),$(this).hide()}})),$("#minwidthinput").on("input",(function(e){e.preventDefault(),c.setCustomSize()})),$("#minheightinput").on("input",(function(e){e.preventDefault(),c.setCustomSize()})),$(".typeMenu").on("click",(function(e){i.imgtype=$(e.target).attr("typeConf"),0==i.imgtype.indexOf("any")&&(i.imgtype=null),$(this).find("div[typeConf]").each((function(){$(this).removeClass("selected")}));var t=$(e.target).closest(".filters > div").find(".menuLabel");t.removeClass("changedMenu"),t.html("Type"),i.imgtype&&(t.addClass("changedMenu"),t.html(i.imgtype)),$(e.target).addClass("selected"),c.foundlastimage(),$(this).hide()})),$(".layoutMenu").on("click",(function(e){i.layout=$(e.target).attr("layoutConf"),0==i.layout.indexOf("any")&&(i.layout=null),$(this).find("div[layoutConf]").each((function(){$(this).removeClass("selected")}));var t=$(e.target).closest(".filters > div").find(".menuLabel");t.removeClass("changedMenu"),t.html("Layout"),i.layout&&(t.addClass("changedMenu"),t.html(i.layout.charAt(0).toUpperCase()+i.layout.slice(1))),$(e.target).addClass("selected"),c.foundlastimage(),$(this).hide()})),$(".sortMenu").on("click",(function(e){i.sort=$(e.target).attr("sortconf"),$(this).find("div[sortconf]").each((function(){$(this).removeClass("selected")})),$(e.target).addClass("selected"),chrome.storage.sync.set({sort:i.sort}),$(this).hide();var t=document.querySelector("#imgsContainer"),n=Array.from(t.querySelectorAll(".imgContainer")).sort((function(e,t){return parseInt(e.getAttribute(i.sort))<parseInt(t.getAttribute(i.sort))?1:-1}));"index"==i.sort&&(n=n.reverse()),n.forEach((function(e){return t.appendChild(e)}))})),$(".clearFilters").on("click",(function(){c.saveSizeConf(!0),document.location.reload()})),$(".captureSelection").on("click",(function(){c.captureSelection()}))},setCustomSize:function(){i.sizetype="custom",i.minwidth=parseInt($("#minwidthinput").val()||0),i.minheight=parseInt($("#minheightinput").val()||0);var e=$("#sizeTab").find(".menuLabel");e.html("Size"),e.removeClass("changedMenu"),i.minwidth==i.defaults.minwidth&&i.minheight==i.defaults.minheight||(e.html("> ".concat(i.minwidth,"&times;").concat(i.minheight)),e.addClass("changedMenu")),$("#sizeTab").find("div[sizeConf]").each((function(){$(this).removeClass("selected")})),$("#sizeTab").find("div[sizeConf=custom]").addClass("selected"),c.foundlastimage()},getConf:function(e){chrome.tabs.query({active:!0,currentWindow:!0},(function(t){c.tabid=t[0].id,chrome.runtime.sendMessage({msg:"canDisplayInSidePanel"},(function(t){c.canDisplayInSidePanel=t,chrome.storage.sync.get(i.defaults,(function(t){for(var n in t)i[n]=t[n];i.displayMode=c.canDisplayInSidePanel?t.displayMode:"popup",e(),c.numviews=t.numviews+1;var o=c.numviews>1e3?1e5:c.numviews>100?1e3:c.numviews>10?100:10;c.numviews%o==0&&c.showRating(),chrome.storage.sync.set({numviews:c.numviews}),chrome.storage.sync.get("web2jpg",(function(e){if(e.web2jpg)try{chrome.storage.sync.remove("web2jpg"),i.convertfrom==i.defaults.convertfrom&&(i.convertfrom="WEBP",i.convertto="jpeg",chrome.storage.sync.set({convertfrom:i.convertfrom,convertto:i.convertto}),$("#convertFrom").val(i.convertfrom),$("#convertTo").val(i.convertto))}catch(e){}}))}))}))}))},captureSelection:function(){chrome.tabs.query({active:!0,currentWindow:!0},(function(e){var t=e[0];chrome.scripting.executeScript({target:{tabId:t.id},files:["captureSelection.js"]},(function(e){chrome.tabs.sendMessage(t.id,{msg:"initSelection"},(function(){chrome.runtime.onMessage.addListener(c.renderSelection)}))}))}))},renderSelection:function(e){if("returnSelection"===e.msg){chrome.runtime.onMessage.removeListener(c.renderSelection);var t=e.rect;setTimeout((function(){chrome.tabs.captureVisibleTab(null,{format:"png"},(function(e){var n=new Image;n.src=e,n.onload=function(){var e=document.createElement("canvas");e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(n,t.x,t.y,t.width,t.height,0,0,e.width,e.height);var o=e.toDataURL("image/png");c.addImage(o,!0),numImagesFoundSpan=document.querySelector("#numimagesfound span");var a=parseInt(numImagesFoundSpan.innerHTML);numImagesFoundSpan.innerHTML=++a}}))}),500)}},foundlastimage:function(){return t(a().mark((function e(){var t,n,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:$("#loadingBack")[0]||"none"!=$("#spinner")[0].style.display||((t=document.createElement("div")).id="loadingBack",t.className="disableBackround",t.style.top="".concat($("#imgsContainer").offset().top,"px"),(n=document.createElement("div")).innerHTML="loading...",n.className="progressText",n.style.width="auto",t.appendChild(n),$("#imgsContainer")[0].appendChild(t),$(".statusdivcontainer")[0].style.zIndex="10000"),$("#loadingBack")[0]&&$("#loadingBack")[0].remove(),$(".statusdivcontainer")[0].style.zIndex="",o=c.imagesCT,i.savesize&&c.saveSizeConf(),$(".imgContainer").each((function(){var e=$(this);c.selectImg(this,!0,!1),e[0].className="imgContainer";var t=e.attr("imgsrc"),n=o[t],a=parseInt(e.attr("width")),r=parseInt(e.attr("height")),s=e.attr("sizeType"),l=e.attr("layout"),d=e.attr("type");"-"==d&&n&&(d=c.getImgType(t,n.mimeType))&&"-"!=d&&(e.find(".imgType").html(d),e.attr("type",d)),n&&n.contentLength&&e.find(".imgDimension").html(c.formatBytes(n.contentLength,0)),i.imgtype&&d!=i.imgtype&&e.addClass("excluded excludedType"),("any"!=i.sizetype&&"custom"!=i.sizetype&&i.sizetype!=s||!(a>=i.minwidth&&r>=i.minheight))&&e.addClass("excluded excludedSize"),-1==t.toLowerCase().indexOf(i.urlpattern.toLowerCase())&&e.addClass("excluded excludedUrl"),i.layout&&l!=i.layout&&e.addClass("excluded excludedLayout")})),c.populateStats(),$(".changedMenu").length>0?$(".clearFilters").show():$(".clearFilters").hide(),document.getElementById("spinner").style.display="none",document.querySelectorAll(".imgContainer").forEach((function(e){e.style.display="-webkit-box"})),document.getElementById("searchingimages").style.display="none",document.getElementById("numimagesfound").style.display="",document.getElementById("selectalla").style.visibility="visible",$("#imgsContainer").attr("finished",!0),c.removeReferrersRules(),c.stopCTListeners();case 16:case"end":return e.stop()}}),e)})))()},populateStats:function(){var e=".imgContainer:not(.excludedUrl):not(.excludedType):not(.excludedLayout)",t=".imgContainer:not(.excludedUrl):not(.excludedSize):not(.excludedLayout)",n=".imgContainer:not(.excludedUrl):not(.excludedSize):not(.excludedType)";c.stats={size:{any:$(e).length,small:$("".concat(e,"[sizeType='small']")).length,medium:$("".concat(e,"[sizeType='medium']")).length,large:$("".concat(e,"[sizeType='large']")).length},types:{any:$(t).length,JPG:$("".concat(t,"[type='JPG']")).length,GIF:$("".concat(t,"[type='GIF']")).length,PNG:$("".concat(t,"[type='PNG']")).length,SVG:$("".concat(t,"[type='SVG']")).length,WEBP:$("".concat(t,"[type='WEBP']")).length,BMP:$("".concat(t,"[type='BMP']")).length,ICO:$("".concat(t,"[type='ICO']")).length,TIFF:$("".concat(t,"[type='TIFF']")).length,AVIF:$("".concat(t,"[type='AVIF']")).length},layout:{any:$(n).length,square:$("".concat(n,"[layout='square']")).length,wide:$("".concat(n,"[layout='wide']")).length,tall:$("".concat(n,"[layout='tall']")).length}},$(".typeMenu").find("div[typeConf]").each((function(){var e=$(this).attr("typeConf"),t=c.stats.types[e];t=t||0,$(this).html("".concat(e.charAt(0).toUpperCase()+e.slice(1)," (").concat(t,")")),t||this.classList.add("zeroResults")})),$(".sizeMenu").find("div[sizeConf]").each((function(){var e=$(this).attr("sizeConf");if("custom"!=e){var t=c.stats.size[e];t=t||0,$(this).html("".concat(e.charAt(0).toUpperCase()+e.slice(1)," (").concat(t,")")),t||this.classList.add("zeroResults")}})),$(".layoutMenu").find("div[layoutConf]").each((function(){var e=$(this).attr("layoutConf"),t=c.stats.layout[e];t=t||0,$(this).html("".concat(e.charAt(0).toUpperCase()+e.slice(1)," (").concat(t,")")),t||this.classList.add("zeroResults")})),document.querySelector("#numimagesfound span").innerHTML=document.querySelectorAll(".imgContainer:not(.excluded)").length},getImgType:function(e,t){var n;try{if(0==e.indexOf("data:image/"))n=e.substring(11,-1!=e.indexOf(";")?e.indexOf(";"):e.indexOf(","));else{var o=e.split("?")[0].split("/").pop();o.includes(".")&&(n=o.substring(o.lastIndexOf(".")))}!n&&t&&(n=t,console.log("got mimeType from CT: ".concat(n)))}catch(e){}return n?-1!=(n=n.toLowerCase()).indexOf("jpg")||-1!=n.indexOf("jpeg")?"JPG":-1!=n.indexOf("gif")?"GIF":-1!=n.indexOf("png")?"PNG":-1!=n.indexOf("svg")?"SVG":-1!=n.indexOf("webp")?"WEBP":-1!=n.indexOf("bmp")?"BMP":-1!=n.indexOf("ico")?"ICO":-1!=n.indexOf("tiff")?"TIFF":-1!=n.indexOf("avif")?"AVIF":"-":"-"},localize:function(){for(var e=document.querySelectorAll(".localizedSpan"),t=0;t<e.length;t++){var n=chrome.i18n.getMessage(e[t].getAttribute("messagesKey"));n&&(e[t].innerHTML=n)}$("#filterbyurlinput")[0].setAttribute("placeholder",chrome.i18n.getMessage("filterbyurlinputplaceholder"))},formatBytes:function(e,t){if(0==e)return"0 B";var n=t,o=Math.floor(Math.log(e)/Math.log(1024));return"".concat(parseFloat((e/Math.pow(1024,o)).toFixed(n))," ").concat(["B","KB","MB","GB","TB","PB","EB","ZB","YB"][o])},saveSizeConf:function(e){chrome.storage.sync.set({sizetype:e?i.defaults.sizetype:i.sizetype,minwidth:e?i.defaults.minwidth:i.minwidth,minheight:e?i.defaults.minheight:i.minheight})},initSizeMenu:function(){var e=$("#sizeTab");if(i.minwidth==i.defaults.minwidth&&i.minheight==i.defaults.minheight||(i.savesize=!0,i.sizetype="custom"),i.savesize){e.find("div[sizeConf]").removeClass("selected"),e.find("div[sizeConf=".concat(i.sizetype,"]")).addClass("selected"),$("#minwidthinput").val(i.minwidth),$("#minheightinput").val(i.minheight),e.find(".savesize").addClass("selected");var t=e.find(".menuLabel");switch(i.sizetype){case"any":break;case"custom":t.addClass("changedMenu"),t.html("> ".concat(i.minwidth,"&times;").concat(i.minheight));break;default:t.addClass("changedMenu"),t.html(i.sizetype.charAt(0).toUpperCase()+i.sizetype.slice(1))}$(".changedMenu").length>0&&$(".clearFilters").show()}},initSortMenu:function(){var e=$("#sortTab");e.find("div[sortconf]").removeClass("selected"),e.find("div[sortconf=".concat(i.sort,"]")).addClass("selected")},getAbsolutePosition:function(e){var t=e.getBoundingClientRect();return t.x+=window.scrollX,t.y+=window.scrollY,t},getHeaderFromHeaders:function(e,t){for(var n=0;n<e.length;++n){var o=e[n];if(o.name.toLowerCase()===t)return o.value}},onBeforeRedirectListener:function(e){e.initiator===location.origin&&(c.redirectRequests[e.redirectUrl]=e.url)},onCompletedListener:function(e){if(e.initiator===location.origin){var t=c.redirectRequests[e.url]||e.url;c.imagesCT[t]={mimeType:c.getHeaderFromHeaders(e.responseHeaders,"content-type"),contentLength:c.getHeaderFromHeaders(e.responseHeaders,"content-length")}}},initCTListeners:function(){chrome.webRequest.onBeforeRedirect.addListener(c.onBeforeRedirectListener,{urls:["<all_urls>"],types:["image"]}),chrome.webRequest.onCompleted.addListener(c.onCompletedListener,{urls:["<all_urls>"],types:["image"]},["responseHeaders"])},stopCTListeners:function(){chrome.webRequest.onBeforeRedirect.removeListener(c.onBeforeRedirectListener),chrome.webRequest.onCompleted.removeListener(c.onCompletedListener)},saveDownloadOptions:function(){$(".savedownloadoptions").hasClass("selected")&&(i.savedownloadoptions=!0,i.savefoldername=$("#savefoldername").val(),i.savefoldername!=i.defaults.savefoldername&&(i.savefoldername=sanitize(i.savefoldername,{replacement:"_"})),i.savefilename=$("#savefilename").val(),i.savefilename=sanitize(i.savefilename,{replacement:"_"}),i.convertfrom=$("#convertFrom").val(),i.convertto=$("#convertTo").val(),chrome.storage.sync.set({savefoldername:i.savefoldername,savefilename:i.savefilename,savedownloadoptions:i.savedownloadoptions,convertfrom:i.convertfrom,convertto:i.convertto})),c.setDownloadOptionsChanged()},saveDownloadOptionsFromPrefs:function(){$("#downloadseparatefolder").is(":checked")?($(".savedownloadoptions").removeClass("selected").addClass("selected"),$("#savefoldername").val($("#savefoldernamePrefs").val()),$("#savefilename").val($("#savefilenamePrefs").val()),$("#convertFrom").val($("#convertFromPrefs").val()),$("#convertTo").val($("#convertToPrefs").val()),c.saveDownloadOptions()):i.savedownloadoptions&&(i.savedownloadoptions=!1,i.savefoldername=i.defaults.savefoldername,i.savefilename=i.defaults.savefilename,i.convertfrom=i.defaults.convertfrom,i.convertto=i.defaults.convertto,$(".savedownloadoptions").removeClass("selected"),$("#savefoldername").val(i.savefoldername),$("#savefilename").val(i.savefilename),$("#convertFrom").val(i.convertfrom),$("#convertTo").val(i.convertto),chrome.storage.sync.set({savefoldername:i.savefoldername,savefilename:i.savefilename,savedownloadoptions:i.savedownloadoptions,convertfrom:i.convertfrom,convertto:i.convertto}),c.setDownloadOptionsChanged())},setDownloadOptionsChanged:function(){$("#savefoldername").val()!=i.defaults.savefoldername||$("#savefilename").val()!=i.defaults.savefilename||$("#convertFrom").val()!=i.defaults.convertfrom?$(".showDownloadOptions").addClass("changed"):$(".showDownloadOptions").removeClass("changed")}};c.getConf(c.init)})()})();